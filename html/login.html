<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<title>登陆</title>
		<link rel="stylesheet" type="text/css" href="../css/Hui.css"/>
		<link rel="stylesheet" type="text/css" href="http://at.alicdn.com/t/font_1473400521_644818.css"/>
		<style>
			body {
				background: url(../image/login_bg.jpg) no-repeat left top;
				background-size: cover;
			}
			.form {
				width: 90%;
				margin: 34% auto 0 auto;
			}
			.from_1 {
				background-color: rgba(249, 249, 249, 0.11);
			}
			.H-theme-font-btn {
				background-color: #ffae00;
			}
			.H-theme-border-color9 {
				border: 1px solid #ffae00;
			}
			.H-theme-font-white {
				color: white;
			}
			.H-theme-border-white {
				border: 1px solid #ffffff;
			}
			.H-font-size-42 {
				font-size: 30px;
			}
		</style>
	</head>
	<body class="H-height-100-percent H-box-sizing-border-box H-overflow-hidden">
		<div class="fix">
			<div class="H-horizontal-center H-padding-vertical-both-25"></div>
			<div class=" form   ">
				<div class="from_1 H-theme-background-color-red ">
					<div class="H-flexbox-horizontal  H-border-vertical-bottom-margin-both-10-after">
						<span class="H-icon H-vertical-middle H-padding-horizontal-left-10"> </i></span>
						<input type="text" value="" id="name" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-18 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-15 H-theme-background-color-transparent H-horizontal-center H-theme-font-color-white H-text-align-center " placeholder="请输入账号或手机号" />
					</div>
					<div class="H-flexbox-horizontal ">
						<span class="H-icon H-vertical-middle H-padding-horizontal-left-10"> </span>
						<input type="password" id="password" class="H-textbox H-vertical-align-middle H-vertical-middle H-font-size-18 H-flex-item H-box-sizing-border-box H-border-none H-outline-none H-padding-15 H-theme-background-color-transparent H-horizontal-center  H-theme-font-color-white H-text-align-center" placeholder="请输入密码" />
					</div>
				</div>
				<div class="H-width-90-percent H-margin-vertical-top-10">
					<button id="login" class="H-button H-width-100-percent  H-font-size-35 H-outline-none H-padding-vertical-both-15 H-padding-horizontal-both-20 H-theme-background-color9 H-theme-font-btn H-theme-border-color9 H-theme-border-yellow-click H-theme-background-yellow-click H-theme-font-color9-click H-border-radius-3">
						登录
					</button>
				</div>
				<div class="H-padding-vertical-bottom-10"></div>
				<div class="H-margin-horizontal-both-15">
					<span tapmode="" onclick="reg()" class="H-theme-font-white H-float-left H-font-size-14">注册</span><span class="H-theme-font-white H-float-right H-font-size-14">忘记密码？</span>
				</div>
			</div>
		</div>
		<div class="H-padding-vertical-bottom-10"></div>
		<div class="H-theme-font-white H-text-align-center H-padding-vertical-both-10 H-font-size-14">
			<div class="H-padding-vertical-bottom-10"></div>
			其他方式登录
		</div>
		<div class="H-flexbox-horizontal H-text-align-center  H-padding-vertical-both-15">
			<div onclick="weilogin()" class="H-flex-item">
				<span class="H-icon H-center-all H-theme-background-color-transparent H-theme-border-white H-border-radius-circle H-margin-horizontal-auto" style="height: 65px; width: 65px; "><i class="iconfont icon-weixin H-font-size-42 H-theme-font-color-white"></i></span>
				<!--<label class="H-display-block H-font-size-13 H-margin-vertical-top-5 H-theme-font-white">腾讯微信</label>-->
			</div>
			<div class="H-flex-item">
				<span class="H-icon H-center-all H-theme-background-color-transparent H-theme-border-white H-border-radius-circle H-margin-horizontal-auto" style="height: 65px; width: 65px; "><i class="iconfont icon-weibo H-font-size-42 H-theme-font-color-white"></i></span>
				<!--<label class="H-display-block H-font-size-13 H-margin-vertical-top-5 H-theme-font-white">新浪微博</label>-->
			</div>
			<div class="H-flex-item">
				<span class="H-icon H-center-all H-theme-background-color-transparent H-theme-border-white H-border-radius-circle H-margin-horizontal-auto" style="height: 65px; width: 65px; "><i class="iconfont icon-qq H-font-size-42 H-theme-font-color-white"></i></span>
				<!--<label class="H-display-block H-font-size-13 H-margin-vertical-top-5 H-theme-font-white">腾讯QQ</label>-->
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../script/api.js"></script>
	<script type="text/javascript" src="../script/jie.js"></script>
	<script type="text/javascript">
		function weilogin() {
			var wx = api.require('wx');
			wx.auth({
				apiKey : ''
			}, function(ret, err) {
				if (ret.status) {
					code = ret.code
					wx.getToken({
						apiKey : '',
						apiSecret : '',
						code : code
					}, function(ret, err) {
						if (ret.status) {
							var accessToken = ret.accessToken;
							var openId = ret.openId;
							wx.getUserInfo({
								accessToken : accessToken,
								openId : openId
							}, function(ret, err) {
								if (ret.status) {
									$api.setStorage('info', ret);
									api.ajax({
										url : hostUrl + 'login.php',
										timeout : 30,
										dataType : 'json',
										returnAll : false,
										data : {
											values : {
												appID : 'zwy1299',
												wx_uid : openId,
												nickname : ret.nickname,
												headpic : ret.headimgurl
											},
										}
									}, function(ret, err) {
										//											api.alert({
										//												msg : JSON.stringify(ret)
										//											});
									});
									api.openWin({
										name : 'userhead',
										url : 'user_head.html',
										delay : 200
									});
									api.toast({
										msg : '登录成功!'
									});
								} else {
									alert(err.code);
								}
							});
						} else {
							alert(err.code);
						}
					});
				} else {
					alert(err.code);
				}
			});
		}

		apiready = function() {
			$api.byId('login').onclick = function() {
				if ($api.byId('name').value.length == 0) {
					$api.byId('name').focus();
					api.toast({
						msg : '用户名不能为空'
					});
					return;
				} else if ($api.byId('password').value.length == 0) {
					$api.byId('password').focus();
					api.toast({
						msg : '密码不能为空！'
					});
					return;
				} else {
					//						var nameVal = $api.byId('name').value;
					var nameVal = $api.val($api.byId('name'));
					var passwordVal = $api.byId('password').value;
					api.ajax({
						url : Api + 'login.html',
						method : 'post',
						timeout : 30,
						dataType : 'json',
						returnAll : false,
						data : {
							values : {
								username : nameVal,
								password : passwordVal,
							},
						}
					}, function(ret, err) {
						if (ret.status == 1) {
							api.toast({
								msg : ret.msg
							});
							api.setPrefs({
								key : 'user',
								value : nameVal
							});
							$api.setStorage('userinfo', ret.data);
							api.setPrefs({
								key : 'userinfo',
								value : ret.data.xu
							});
							api.sendEvent({
								name : 'reg_login_successEvent',
								extra : {
									user : nameVal,
								}
							});
							api.openWin({
								name : 'home',
								url : 'home.html'
							});
							api.closeWin({
								name : 'login_head',
							});
							api.sendEvent({
								name : 'payok',
							})
						} else {
							alert(ret.msg)
						}
					});
				}
			}
		};
	</script>
</html>
