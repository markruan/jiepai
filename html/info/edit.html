<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
		<title>title</title>
		<link rel="stylesheet" type="text/css" href="../../css/Hui.css"/>
		<link rel="stylesheet" type="text/css" href="http://at.alicdn.com/t/font_1473395695_2299788.css"/>
		<style>
			.H-button-1 {
				min-width: 80px;
			}
			.H-theme-background-color-zhuti {
				background-color: #e43252;
			}
			hr {
				border-color: #e6e6e6;
				border-top: 1px;
			}
			.H-theme-border-color8 {
				border: 1px solid #e43252;
			}
		</style>
	</head>
	<body>
		<div class="H-padding-horizontal-both-10">
			<div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-after H-vertical-middle H-touch-active">
				<div  class="H-flex-item H-padding-horizontal-both-10 H-font-size-16 H-padding-vertical-both-12 H-theme-font-color-hhh ">
					账号：<span id="username"> </span>
					<button id="grade" class="H-margin-horizontal-left-10 H-theme-font-color-hhh  H-button-1 H-font-size-15 H-outline-none H-padding-vertical-both-4 H-padding-horizontal-both-5 H-theme-background-color-zhuti H-theme-font-color-white H-theme-border-color8 H-theme-border-color8-click H-theme-background-color8-click H-theme-font-color8-click H-border-radius-3" style="min-width: 60px;">
						等待加载
					</button>
				</div>
				<span class="H-icon H-padding-horizontal-right-5 H-display-block" onclick="changePerson()"> <img id="img" src="" style="width: 80px; height: 80px;border-radius: 40px;margin-top: 5px;margin-right: 10px;" / > <span class="H-icon H-display-block H-position-absolute H-center-all H-border-radius-circle H-z-index-1000 H-line-height-0 H-theme-background-color-zhuti" style="height: 20px; width: 20px; bottom: 5px; right: 5px; "><i id="icon"  class=" iconfont icon-zhaoxiangji H-theme-font-color-white H-font-size-12 H-vertical-align-middle"></i></span> </span>
			</div>
			<div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-after H-vertical-middle ">
				<div   class="H-flex-item H-padding-horizontal-both-10 H-theme-font-color-hhh  H-font-size-16 H-padding-vertical-both-12 ">
					昵称：<span id="nickname" class="H-theme-font-color-hhh "> </span>
				</div>
				<span onclick="xiunick()" class=" H-padding-horizontal-right-5 H-display-block H-font-size-16  H-padding-horizontal-right-20 H-touch-active">修改</span>
				<span class="H-icon H-padding-horizontal-right-5 H-display-block"></span>
			</div>
			<div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-after H-vertical-middle ">
				<div   class="H-flex-item H-theme-font-color-hhh  H-padding-horizontal-both-10 H-font-size-16 H-padding-vertical-both-12">
					手机：<span id="phone" class="H-theme-font-color-hhh ">请绑定认证</span>
				</div>
				<span onclick="opensms()" class="H-theme-font-color-hhh  H-padding-horizontal-right-5 H-display-block H-font-size-16  H-padding-horizontal-right-20 H-touch-active">手机绑定</span>
				<span class="H-icon H-padding-horizontal-right-5 H-display-block"></span>
			</div>
			<div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-after H-vertical-middle ">
				<div class="H-flex-item H-theme-font-color-hhh  H-padding-horizontal-both-10 H-font-size-16 H-padding-vertical-both-12">
					重置密码
				</div>
				<span onclick="xiupsw()" class=" H-padding-horizontal-right-5 H-display-block H-font-size-16  H-padding-horizontal-right-20 H-touch-active H-theme-font-color-hhh ">修改</span>
			</div>
			<div class="H-text-list H-flexbox-horizontal  H-theme-background-color-white H-border-vertical-bottom-after H-vertical-middle ">
				<div class="H-flex-item H-theme-font-color-hhh  H-padding-horizontal-both-10 H-font-size-16 H-padding-vertical-both-12">
					购买记录
				</div>
				<span onclick="goumaijilu()" class=" H-padding-horizontal-right-5 H-display-block H-font-size-16  H-padding-horizontal-right-20 H-touch-active H-theme-font-color-hhh "> <i class="H-iconfont H-icon-arrow-right"></i></span>
			</div>
			<div class="  H-center-all "style="margin-top: 80px">
				<button onclick="logout()" class="H-theme-font-color-hhh  H-margin-horizontal-left-10 H-button H-font-size-15 H-outline-none H-padding-vertical-both-10 H-padding-horizontal-both-20 H-theme-background-color-zhuti H-theme-font-color-white H-theme-border-color8 H-theme-border-color8-click H-theme-background-color8-click H-theme-font-color8-click H-border-radius-3" style="min-width: 250px">
					注销登录
				</button>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/jie.js"></script>
	<script type="text/javascript">
		function xiupsw() {
			api.openWin({
				name : 'psw_head',
				url : '../../html/info/psw_head.html',
			});
		}

		function xiunick() {
			api.openWin({
				name : 'nick_head',
				url : '../../html/info/nick_head.html',
			});
		}

		function goumaijilu() {
			api.openWin({
				name : 'goumai_head',
				url : '../../html/goumaijilu/goumai_head.html',
			});
		}

		function opensms() {
			api.openWin({
				name : 'opensms',
				url : '../../html/info/edit_head.html',
			});
		}

		function logout() {
			api.sendEvent({
				name : 'logout'
			});
			api.removePrefs({
				key : 'weilogin'
			});
			api.removePrefs({
				key : 'weixinlogin'
			});
			api.removePrefs({
				key : 'user'
			});
			$api.rmStorage('userinfo');
			api.removePrefs({
				key : 'userinfo'
			});
			api.removePrefs({
				key : 'quanji'
			});
			api.closeFrame({
				name : 'me'
			});
			api.openWin({
				name : 'home1',
				url : '../../html/home.html'
			});
			setTimeout(close(), 1600)
		}

		function close() {
			api.closeWin({
				name : 'info'
			});
		}

		function reload() {
			api.openFrame({
				name : 'edit',
				reload : true
			});
		}

		function intt() {
			var ret = $api.getStorage('userinfo');
			if (ret) {
				$api.text($api.byId('username'), ret.username);
				api.ajax({
					url : Api + 'userinfo.html',
					method : 'post',
					timeout : 30,
					dataType : 'json',
					returnAll : false,
					data : {
						values : {
							username : ret.username,
						},
					}
				}, function(ret, err) {
					console.log(JSON.stringify(ret))
					$api.text($api.byId('nickname'), ret.nickname);
					$api.text($api.byId('grade'), ret.fname);
					$api.text($api.byId('phone'), ret.phone);
					if (ret.phone) {
					} else {
						api.toast({
							msg : '请绑定手机认证否无法，否则密码丢失后将无法找回'
						});
					}
					if (ret.icon.substr(0, 7) == "http://") {
						$api.attr($api.byId('img'), 'src', ret.icon)
						//这部分是以http://为开头的处理
					} else {
						$api.attr($api.byId('img'), 'src', uploadUrl + ret.icon);
					}
					console.log(uploadUrl + ret.icon)
					api.refreshHeaderLoadDone();
				});
			} else {
			}
		}

		function openImageClipFrame(img_src) {
			api.openFrame({
				name : 'tu',
				scrollToTop : true,
				allowEdit : true,
				url : 'tu.html',
				rect : {
					x : 0,
					y : 0,
					w : api.winWidth,
					h : api.winHeight,
				},
				animation : {
					type : "reveal", //动画类型（详见动画类型常量）
					subType : "from_right", //动画子类型（详见动画子类型常量）
					duration : 300
				},
				pageParam : {
					img_src : img_src
				},
				vScrollBarEnabled : false,
				hScrollBarEnabled : false,
				//页面是否弹动 为了下拉刷新使用
				bounces : false
			});
		}

		function changePerson() {
			api.getPicture({
				sourceType : 'library',
				encodingType : 'png',
				mediaValue : 'pic',
				destinationType : 'url',
				allowEdit : true,
				saveToPhotoAlbum : false,
				quality : 35
			}, function(ret, err) {
				if (ret.data != '') {
					openImageClipFrame(ret.data)
				} else {
					return api.alert({
						msg : err.msg
					});
				} ;
			});
		}

		apiready = function() {
			var userName = api.getPrefs({
				sync : true,
				key : 'user'
			});
			api.setRefreshHeaderInfo({
				visible : true,
				bgColor : '#f2f2f2',
				textColor : '#4d4d4d',
				textDown : '下拉刷新...',
				textUp : '松开刷新...',
				showTime : true
			}, function(ret, err) {
				intt()
			});
			intt()
			 
			api.addEventListener({
				name : 'iconupdata'
			}, function(ret, err) {
				if (ret) {
					var img_url = ret.value.img_path
					api.showProgress({
						title : ' 上传中...',
						text : '先喝杯茶...',
						modal : false
					}), api.ajax({
						timeout : 300,
						method : 'post',
						url : Api + 'changIcon.html',
						data : {
							files : {
								upfile : img_url
							},
							values : {
								username : userName
							},
						},
						dataType : 'text',
					}, function(ret, err) {
						if (ret != 1) {
							var url = uploadUrl + ret;
							$api.attr($api.byId('img'), 'src', url);
							api.toast({
								msg : '更新成功'
							});
							api.sendEvent({
								name : 'payok',
							})
							api.hideProgress();
							var jsfun = 'int()';
							api.execScript({
								name : 'root',
								frameName : 'me',
								script : jsfun
							});
						} else {
							alert('图片尺寸太大请重新上传')
							api.hideProgress();
						}
					});
				}
				//coding...
			});
		};
	</script>
</html>